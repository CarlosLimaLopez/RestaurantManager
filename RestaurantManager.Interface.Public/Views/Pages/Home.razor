@page "/"
@using RestaurantManager.Restaurants

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudGrid>
        @foreach (var restaurant in Restaurants)
        {
            <MudItem xs="6" md="3">
                <NavLink href="@($"/menu/{restaurant.Path}")">
                    <MudCard Class="d-flex flex-column align-center" Style="height: 100%;" Elevation="2">
                        <MudCardContent Class="d-flex flex-column align-center justify-center flex-grow-1">
                            @if (!string.IsNullOrEmpty(restaurant.LogoPath))
                            {
                                <MudImage Src="@restaurant.LogoPath" Alt="@restaurant.Name" Class="rounded mb-3" Width="100" Height="100" ObjectFit="ObjectFit.Contain" />
                            }
                            else
                            {
                                <MudIcon Icon="@Icons.Material.Filled.Restaurant" Size="Size.Large" Class="mb-3" Style="font-size: 100px;" />
                            }
                            <MudText Typo="Typo.h6" Align="Align.Center" Style="@GetColorStyle(restaurant.NameColor)">
                                @restaurant.Name
                            </MudText>
                        </MudCardContent>
                    </MudCard>
                </NavLink>
            </MudItem>
        }
    </MudGrid>
</MudContainer>

@code{
    [Inject]
    private HttpClient Http { get; set; } = default!;

    [Inject]
    private NavigationManager Navigation { get; set; } = default!;

    private RestaurantSummaryGetResponse[] Restaurants { get; set; } = [];

    protected override async Task OnInitializedAsync() => await ReloadGrid();

    private string GetColorStyle(string? color) => $"color: {(string.IsNullOrEmpty(color) ? "inherit" : color)}";

    private async Task ReloadGrid()
    {
        var result = await Http.GetFromJsonAsync<RestaurantSummaryGetResponse[]>("restaurants", CancellationToken.None);
        if (result is not null)
            Restaurants = result;
    }

    private void NavigateToActiveMenu(string path)
    {
        Console.WriteLine($"Navegando a: /menu/{path}");
        Navigation.NavigateTo($"/menu/{path}");
    }
}
